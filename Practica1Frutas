import cv2
import numpy as np

# 1. Leer la imagen
img = cv2.imread('C:\\Users\\adria\\Desktop\\entorno\\TareasGrafi\\frutas.png')

# 2. Convertir al espacio de color HSV
hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)

# 3. Rangos para el verde
lower_green = np.array([35, 50 , 50])
upper_green = np.array([85, 255, 255])
# Rango para el rojo
lower_red = np.array([0, 100, 100])
upper_red = np.array([10, 255, 255])
# Rango para el amarillo 
lower_yellow = np.array([20, 100, 100])
upper_yellow = np.array([32, 255, 255])


# 4. Crear máscara y limpiar ruido (Actividad 2)
mask_green = cv2.inRange(hsv, lower_green, upper_green) # Máscara original [cite: 10]
kernel = np.ones((5,5), np.uint8)
# Aplicamos apertura para eliminar ruido [cite: 11]
mask_cleaned = cv2.morphologyEx(mask_green, cv2.MORPH_OPEN, kernel) 

# 5. Conteo de regiones (Actividad 3)
# Esta función busca manchas blancas conectadas 
num_labels, labels, stats, centroids = cv2.connectedComponentsWithStats(mask_cleaned, connectivity=8)

# El conteo incluye el fondo, así que restamos 1 para tener el total de frutas [cite: 14]
total_frutas = num_labels - 1

print(f"Se detectaron {total_frutas} regiones verdes.")

# Imprimir el área de cada fruta (Actividad 3.3) [cite: 14]
for i in range(1, num_labels):
    area = stats[i, cv2.CC_STAT_AREA]
    print(f"Fruta {i}: Área = {area} píxeles")

# 6. Mostrar resultados
cv2.imshow("1. Imagen Original", img)
cv2.imshow("2. Imagen en HSV", hsv) 
cv2.imshow("3. Mascara con Ruido", mask_green)
cv2.imshow("4. Mascara Limpia", mask_cleaned) 


cv2.waitKey(0)
cv2.destroyAllWindows()